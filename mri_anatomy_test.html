<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MRI Registry Visual Anatomy Test</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 { font-size: 2em; margin-bottom: 10px; }
        
        .progress-bar {
            background: #f0f0f0;
            height: 8px;
            position: relative;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .content { padding: 40px; }
        
        .question-container { display: none; }
        .question-container.active { display: block; animation: fadeIn 0.5s; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .question-number {
            font-size: 0.9em;
            color: #667eea;
            font-weight: bold;
        }
        
        .region-tag {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
        }
        
        .anatomy-image-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .anatomy-svg {
            max-width: 100%;
            height: auto;
            margin: 0 auto;
            display: block;
        }
        
        .question-text {
            font-size: 1.2em;
            color: #333;
            margin-bottom: 25px;
            line-height: 1.6;
            font-weight: 500;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }
        
        .option {
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            text-align: center;
        }
        
        .option:hover { background: #e9ecef; transform: translateY(-2px); }
        .option input[type="radio"] { display: none; }
        .option.selected { border-color: #667eea; background: #e8eaf6; }
        .option.correct { border-color: #4caf50; background: #e8f5e9; }
        .option.incorrect { border-color: #f44336; background: #ffebee; }
        
        .explanation {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            border-radius: 5px;
        }
        
        .explanation.show { display: block; animation: fadeIn 0.5s; }
        .explanation h4 { color: #856404; margin-bottom: 10px; }
        
        .buttons { display: flex; gap: 15px; margin-top: 30px; }
        
        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary { background: #e9ecef; color: #333; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .results { display: none; text-align: center; padding: 40px; }
        .results.show { display: block; }
        
        .score-circle {
            width: 200px;
            height: 200px;
            margin: 0 auto 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3em;
            font-weight: bold;
        }
        
        .category-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .category-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        @media (max-width: 768px) {
            .content { padding: 20px; }
            .buttons { flex-direction: column; }
            .options { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† MRI Registry Visual Anatomy Test</h1>
            <p>Identify anatomical structures on diagrams - 20 Questions</p>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <div class="content">
            <div id="questionsContainer"></div>
            
            <div class="results" id="results">
                <div class="score-circle" id="scoreCircle">0%</div>
                <h2>Test Complete!</h2>
                <p id="resultMessage"></p>
                
                <div class="category-breakdown" id="categoryBreakdown"></div>
                
                <div class="buttons">
                    <button class="btn btn-primary" onclick="restartTest()">Take Test Again</button>
                    <button class="btn btn-secondary" onclick="reviewAnswers()">Review Answers</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <script>
        const questions = [
            {
                region: "Brain - Sagittal",
                question: "Identify structure 'A' - the largest white matter commissure:",
                svg: '<svg viewBox="0 0 400 500" class="anatomy-svg"><ellipse cx="200" cy="250" rx="150" ry="200" fill="#e8d4c0" stroke="#333" stroke-width="2"/><path d="M 120 200 Q 200 180 280 200" fill="#d4b89d" stroke="#333" stroke-width="2"/><text x="200" y="170" font-size="24" font-weight="bold" fill="red" text-anchor="middle">A</text><circle cx="250" cy="380" r="60" fill="#c9b5a0" stroke="#333" stroke-width="2"/><text x="250" y="340" font-size="24" font-weight="bold" fill="blue" text-anchor="middle">B</text><ellipse cx="200" cy="240" rx="30" ry="25" fill="#b8a896" stroke="#333" stroke-width="2"/><text x="160" y="250" font-size="24" font-weight="bold" fill="orange" text-anchor="middle">C</text></svg>',
                options: ["Cerebellum", "Corpus Callosum", "Pons", "Thalamus"],
                correct: 1,
                explanation: "The Corpus Callosum (A) is the largest white matter commissure connecting the left and right cerebral hemispheres. It consists of the rostrum, genu, body, and splenium."
            },
            {
                region: "Brain - Sagittal",
                question: "Identify structure 'B' - controls balance and coordination:",
                svg: '<svg viewBox="0 0 400 500" class="anatomy-svg"><ellipse cx="200" cy="250" rx="150" ry="200" fill="#e8d4c0" stroke="#333" stroke-width="2"/><path d="M 120 200 Q 200 180 280 200" fill="#d4b89d" stroke="#333" stroke-width="2"/><text x="200" y="170" font-size="24" font-weight="bold" fill="red" text-anchor="middle">A</text><circle cx="250" cy="380" r="60" fill="#c9b5a0" stroke="#333" stroke-width="2"/><text x="250" y="340" font-size="24" font-weight="bold" fill="blue" text-anchor="middle">B</text><ellipse cx="200" cy="240" rx="30" ry="25" fill="#b8a896" stroke="#333" stroke-width="2"/><text x="160" y="250" font-size="24" font-weight="bold" fill="orange" text-anchor="middle">C</text></svg>',
                options: ["Pons", "Cerebellum", "Medulla", "Midbrain"],
                correct: 1,
                explanation: "The Cerebellum (B) is located in the posterior fossa and controls motor coordination, balance, and posture. Lesions cause ataxia and dysmetria."
            },
            {
                region: "Brain - Sagittal",
                question: "Identify structure 'C' - the relay station for sensory information:",
                svg: '<svg viewBox="0 0 400 500" class="anatomy-svg"><ellipse cx="200" cy="250" rx="150" ry="200" fill="#e8d4c0" stroke="#333" stroke-width="2"/><path d="M 120 200 Q 200 180 280 200" fill="#d4b89d" stroke="#333" stroke-width="2"/><text x="200" y="170" font-size="24" font-weight="bold" fill="red" text-anchor="middle">A</text><circle cx="250" cy="380" r="60" fill="#c9b5a0" stroke="#333" stroke-width="2"/><text x="250" y="340" font-size="24" font-weight="bold" fill="blue" text-anchor="middle">B</text><ellipse cx="200" cy="240" rx="30" ry="25" fill="#b8a896" stroke="#333" stroke-width="2"/><text x="160" y="250" font-size="24" font-weight="bold" fill="orange" text-anchor="middle">C</text></svg>',
                options: ["Hypothalamus", "Thalamus", "Caudate", "Putamen"],
                correct: 1,
                explanation: "The Thalamus (C) is the largest component of the diencephalon and acts as a relay station for sensory and motor signals to the cerebral cortex."
            },
            {
                region: "Brain - Axial",
                question: "Identify the CSF-filled structures labeled 'A':",
                svg: '<svg viewBox="0 0 400 400" class="anatomy-svg"><ellipse cx="200" cy="200" rx="180" ry="160" fill="#e8d4c0" stroke="#333" stroke-width="2"/><ellipse cx="150" cy="200" rx="30" ry="50" fill="#87CEEB" stroke="#333" stroke-width="2"/><ellipse cx="250" cy="200" rx="30" ry="50" fill="#87CEEB" stroke="#333" stroke-width="2"/><text x="150" y="160" font-size="24" font-weight="bold" fill="red" text-anchor="middle">A</text><ellipse cx="180" cy="210" rx="20" ry="25" fill="#b8a896" stroke="#333" stroke-width="2"/><ellipse cx="220" cy="210" rx="20" ry="25" fill="#b8a896" stroke="#333" stroke-width="2"/><text x="200" y="250" font-size="24" font-weight="bold" fill="blue" text-anchor="middle">B</text></svg>',
                options: ["Third Ventricle", "Lateral Ventricles", "Fourth Ventricle", "Aqueduct"],
                correct: 1,
                explanation: "The Lateral Ventricles (A) are the largest ventricles, located in each cerebral hemisphere. CSF is produced here by the choroid plexus."
            },
            {
                region: "Brain - Axial",
                question: "Identify the basal ganglia structure labeled 'B':",
                svg: '<svg viewBox="0 0 400 400" class="anatomy-svg"><ellipse cx="200" cy="200" rx="180" ry="160" fill="#e8d4c0" stroke="#333" stroke-width="2"/><ellipse cx="150" cy="200" rx="30" ry="50" fill="#87CEEB" stroke="#333" stroke-width="2"/><ellipse cx="250" cy="200" rx="30" ry="50" fill="#87CEEB" stroke="#333" stroke-width="2"/><text x="150" y="160" font-size="24" font-weight="bold" fill="red" text-anchor="middle">A</text><ellipse cx="180" cy="210" rx="20" ry="25" fill="#b8a896" stroke="#333" stroke-width="2"/><ellipse cx="220" cy="210" rx="20" ry="25" fill="#b8a896" stroke="#333" stroke-width="2"/><text x="200" y="250" font-size="24" font-weight="bold" fill="blue" text-anchor="middle">B</text></svg>',
                options: ["Caudate", "Thalamus", "Putamen", "Globus Pallidus"],
                correct: 1,
                explanation: "The Thalamus (B) serves as a relay station for sensory information. Nearly all sensory information (except olfaction) passes through here."
            },
            {
                region: "Knee - Sagittal",
                question: "Identify ligament 'A' - prevents anterior tibial translation:",
                svg: '<svg viewBox="0 0 400 500" class="anatomy-svg"><rect x="150" y="50" width="100" height="150" fill="#f0e6d2" stroke="#333" stroke-width="2"/><path d="M 150 200 L 120 280 L 280 280 L 250 200 Z" fill="#f0e6d2" stroke="#333" stroke-width="2"/><rect x="140" y="320" width="120" height="160" fill="#f0e6d2" stroke="#333" stroke-width="2"/><line x1="180" y1="290" x2="220" y2="250" stroke="#ff6b6b" stroke-width="4"/><text x="160" y="270" font-size="24" font-weight="bold" fill="red" text-anchor="middle">A</text><line x1="220" y1="290" x2="180" y2="250" stroke="#4ecdc4" stroke-width="4"/><text x="240" y="270" font-size="24" font-weight="bold" fill="blue" text-anchor="middle">B</text><ellipse cx="125" cy="230" rx="25" ry="35" fill="#f0e6d2" stroke="#333" stroke-width="2"/><text x="80" y="230" font-size="24" font-weight="bold" fill="purple" text-anchor="middle">C</text></svg>',
                options: ["PCL", "ACL", "MCL", "Patellar Tendon"],
                correct: 1,
                explanation: "The ACL (A) runs from anterior tibia to posterior lateral femur. It prevents anterior translation of the tibia and is commonly torn in sports injuries."
            },
            {
                region: "Knee - Sagittal",
                question: "Identify ligament 'B' - the strongest knee ligament:",
                svg: '<svg viewBox="0 0 400 500" class="anatomy-svg"><rect x="150" y="50" width="100" height="150" fill="#f0e6d2" stroke="#333" stroke-width="2"/><path d="M 150 200 L 120 280 L 280 280 L 250 200 Z" fill="#f0e6d2" stroke="#333" stroke-width="2"/><rect x="140" y="320" width="120" height="160" fill="#f0e6d2" stroke="#333" stroke-width="2"/><line x1="180" y1="290" x2="220" y2="250" stroke="#ff6b6b" stroke-width="4"/><text x="160" y="270" font-size="24" font-weight="bold" fill="red" text-anchor="middle">A</text><line x1="220" y1="290" x2="180" y2="250" stroke="#4ecdc4" stroke-width="4"/><text x="240" y="270" font-size="24" font-weight="bold" fill="blue" text-anchor="middle">B</text><ellipse cx="125" cy="230" rx="25" ry="35" fill="#f0e6d2" stroke="#333" stroke-width="2"/><text x="80" y="230" font-size="24" font-weight="bold" fill="purple" text-anchor="middle">C</text></svg>',
                options: ["ACL", "LCL", "PCL", "Meniscus"],
                correct: 2,
                explanation: "The PCL (B) runs from posterior tibia to anterior medial femur. It prevents posterior tibial translation and is the strongest knee ligament."
            },
            {
                region: "Knee - Sagittal",
                question: "Identify structure 'C' - the kneecap:",
                svg: '<svg viewBox="0 0 400 500" class="anatomy-svg"><rect x="150" y="50" width="100" height="150" fill="#f0e6d2" stroke="#333" stroke-width="2"/><path d="M 150 200 L 120 280 L 280 280 L 250 200 Z" fill="#f0e6d2" stroke="#333" stroke-width="2"/><rect x="140" y="320" width="120" height="160" fill="#f0e6d2" stroke="#333" stroke-width="2"/><line x1="180" y1="290" x2="220" y2="250" stroke="#ff6b6b" stroke-width="4"/><text x="160" y="270" font-size="24" font-weight="bold" fill="red" text-anchor="middle">A</text><line x1="220" y1="290" x2="180" y2="250" stroke="#4ecdc4" stroke-width="4"/><text x="240" y="270" font-size="24" font-weight="bold" fill="blue" text-anchor="middle">B</text><ellipse cx="125" cy="230" rx="25" ry="35" fill="#f0e6d2" stroke="#333" stroke-width="2"/><text x="80" y="230" font-size="24" font-weight="bold" fill="purple" text-anchor="middle">C</text></svg>',
                options: ["Tibial Tuberosity", "Femoral Condyle", "Patella", "Fabella"],
                correct: 2,
                explanation: "The Patella (C) is a sesamoid bone within the quadriceps tendon that increases mechanical advantage and protects the knee joint."
            },
            {
                region: "Shoulder - Coronal",
                question: "Identify rotator cuff muscle 'A' - most commonly torn:",
                svg: '<svg viewBox="0 0 400 400" class="anatomy-svg"><path d="M 100 150 L 150 100 L 250 100 L 300 150 L 280 300 L 120 300 Z" fill="#f0e6d2" stroke="#333" stroke-width="2"/><rect x="180" y="180" width="40" height="180" fill="#f0e6d2" stroke="#333" stroke-width="2"/><circle cx="200" cy="180" r="35" fill="#f0e6d2" stroke="#333" stroke-width="2"/><path d="M 200 110 L 215 160" stroke="#ff6b6b" stroke-width="5"/><text x="230" y="135" font-size="24" font-weight="bold" fill="red" text-anchor="middle">A</text><path d="M 190 180 L 220 170" stroke="#4ecdc4" stroke-width="5"/><text x="250" y="180" font-size="24" font-weight="bold" fill="blue" text-anchor="middle">B</text><path d="M 180 180 L 160 170" stroke="#95a5a6" stroke-width="5"/><text x="130" y="180" font-size="24" font-weight="bold" fill="green" text-anchor="middle">C</text></svg>',
                options: ["Infraspinatus", "Supraspinatus", "Subscapularis", "Teres Minor"],
                correct: 1,
                explanation: "The Supraspinatus (A) is part of SITS (rotator cuff). It initiates shoulder abduction and is the most commonly torn, typically at the greater tuberosity insertion."
            },
            {
                region: "Shoulder - Coronal",
                question: "What muscle group do structures A, B, and C form?",
                svg: '<svg viewBox="0 0 400 400" class="anatomy-svg"><path d="M 100 150 L 150 100 L 250 100 L 300 150 L 280 300 L 120 300 Z" fill="#f0e6d2" stroke="#333" stroke-width="2"/><rect x="180" y="180" width="40" height="180" fill="#f0e6d2" stroke="#333" stroke-width="2"/><circle cx="200" cy="180" r="35" fill="#f0e6d2" stroke="#333" stroke-width="2"/><path d="M 200 110 L 215 160" stroke="#ff6b6b" stroke-width="5"/><text x="230" y="135" font-size="24" font-weight="bold" fill="red" text-anchor="middle">A</text><path d="M 190 180 L 220 170" stroke="#4ecdc4" stroke-width="5"/><text x="250" y="180" font-size="24" font-weight="bold" fill="blue" text-anchor="middle">B</text><path d="M 180 180 L 160 170" stroke="#95a5a6" stroke-width="5"/><text x="130" y="180" font-size="24" font-weight="bold" fill="green" text-anchor="middle">C</text></svg>',
                options: ["Deltoid", "Rotator Cuff (SITS)", "Pectorals", "Trapezius"],
                correct: 1,
                explanation: "These are Rotator Cuff muscles (SITS): Supraspinatus, Infraspinatus, Teres minor, Subscapularis. They stabilize the humeral head."
            },
            {
                region: "Spine - Sagittal",
                question: "Identify structure 'A' - acts as shock absorber:",
                svg: '<svg viewBox="0 0 400 600" class="anatomy-svg"><rect x="150" y="100" width="100" height="60" fill="#f0e6d2" stroke="#333" stroke-width="2"/><rect x="150" y="180" width="100" height="60" fill="#f0e6d2" stroke="#333" stroke-width="2"/><rect x="150" y="260" width="100" height="60" fill="#f0e6d2" stroke="#333" stroke-width="2"/><ellipse cx="200" cy="170" rx="50" ry="10" fill="#8b7d6b" stroke="#333" stroke-width="2"/><text x="270" y="175" font-size="24" font-weight="bold" fill="red" text-anchor="middle">A</text><ellipse cx="200" cy="250" rx="50" ry="10" fill="#8b7d6b" stroke="#333" stroke-width="2"/><ellipse cx="200" cy="330" rx="50" ry="10" fill="#8b7d6b" stroke="#333" stroke-width="2"/><rect x="120" y="110" width="25" height="50" fill="#87CEEB" stroke="#333" stroke-width="1" opacity="0.5"/><rect x="120" y="190" width="25" height="50" fill="#87CEEB" stroke="#333" stroke-width="1" opacity="0.5"/><rect x="120" y="270" width="25" height="50" fill="#87CEEB" stroke="#333" stroke-width="1" opacity="0.5"/><text x="80" y="200" font-size="24" font-weight="bold" fill="blue" text-anchor="middle">B</text><text x="300" y="130" font-size="18" fill="#333">L1</text><text x="300" y="210" font-size="18" fill="#333">L2</text><text x="300" y="290" font-size="18" fill="#333">L3</text></svg>',
                options: ["Vertebral Body", "Intervertebral Disc", "Spinal Cord", "Ligament"],
                correct: 1,
                explanation: "The Intervertebral Disc (A) has an outer annulus fibrosus and inner nucleus pulposus. It acts as a shock absorber between vertebrae."
            },
            {
                region: "Spine - Sagittal",
                question: "Identify structure 'B' - contains spinal cord and CSF:",
                svg: '<svg viewBox="0 0 400 600" class="anatomy-svg"><rect x="150" y="100" width="100" height="60" fill="#f0e6d2" stroke="#333" stroke-width="2"/><rect x="150" y="180" width="100" height="60" fill="#f0e6d2" stroke="#333" stroke-width="2"/><rect x="150" y="260" width="100" height="60" fill="#f0e6d2" stroke="#333" stroke-width="2"/><ellipse cx="200" cy="170" rx="50" ry="10" fill="#8b7d6b" stroke="#333" stroke-width="2"/><text x="270" y="175" font-size="24" font-weight="bold" fill="red" text-anchor="middle">A</text><ellipse cx="200" cy="250" rx="50" ry="10" fill="#8b7d6b" stroke="#333" stroke-width="2"/><ellipse cx="200" cy="330" rx="50" ry="10" fill="#8b7d6b" stroke="#333" stroke-width="2"/><rect x="120" y="110" width="25" height="50" fill="#87CEEB" stroke="#333" stroke-width="1" opacity="0.5"/><rect x="120" y="190" width="25" height="50" fill="#87CEEB" stroke="#333" stroke-width="1" opacity="0.5"/><rect x="120" y="270" width="25" height="50" fill="#87CEEB" stroke="#333" stroke-width="1" opacity="0.5"/><text x="80" y="200" font-size="24" font-weight="bold" fill="blue" text-anchor="middle">B</text><text x="300" y="130" font-size="18" fill="#333">L1</text><text x="300" y="210" font-size="18" fill="#333">L2</text><text x="300" y="290" font-size="18" fill="#333">L3</text></svg>',
                options: ["Vertebral Body", "Epidural Space", "Spinal Canal (Thecal Sac)", "Ligamentum Flavum"],
                correct: 2,
                explanation: "The Spinal Canal/Thecal Sac (B) contains the spinal cord (ending at L1-L2 as conus medullaris) and cauda equina, surrounded by CSF."
            },
            {
                region: "Spine - Anatomy",
                question: "At what level does the spinal cord typically terminate?",
                svg: '<svg viewBox="0 0 300 400" class="anatomy-svg"><rect x="130" y="50" width="40" height="300" fill="#f0e6d2" stroke="#333" stroke-width="2"/><text x="90" y="100" font-size="16" fill="#333">L1</text><text x="90" y="150" font-size="16" fill="#333">L2</text><text x="90" y="200" font-size="16" fill="#333">L3</text><text x="90" y="250" font-size="16" fill="#333">L4</text><ellipse cx="150" cy="125" rx="8" ry="20" fill="#ff6b6b" stroke="#333" stroke-width="2"/><text x="70" y="130" font-size="16" font-weight="bold" fill="red">Conus</text><line x1="150" y1="145" x2="148" y2="230" stroke="#4ecdc4" stroke-width="2"/><line x1="150" y1="145" x2="152" y2="230" stroke="#4ecdc4" stroke-width="2"/><text x="180" y="200" font-size="14" fill="#333">Cauda Equina</text></svg>',
                options: ["T12-L1", "L1-L2", "L3-L4", "L5-S1"],
                correct: 1,
                explanation: "The spinal cord terminates at L1-L2 as the Conus Medullaris. Below this are the nerve roots (Cauda Equina). Important for LP site selection."
            },
            {
                region: "Abdomen - Axial",
                question: "Identify 'A' - the largest solid abdominal organ:",
                svg: '<svg viewBox="0 0 500 400" class="anatomy-svg"><ellipse cx="250" cy="200" rx="200" ry="150" fill="#f5e6d3" stroke="#333" stroke-width="2"/><path d="M 250 100 L 380 150 L 370 250 L 260 230 Z" fill="#8b4513" stroke="#333" stroke-width="2"/><text x="310" y="180" font-size="24" font-weight="bold" fill="red" text-anchor="middle">A</text><ellipse cx="200" cy="180" rx="40" ry="50" fill="#ffb6c1" stroke="#333" stroke-width="2"/><text x="200" y="130" font-size="24" font-weight="bold" fill="blue" text-anchor="middle">B</text><ellipse cx="120" cy="160" rx="35" ry="45" fill="#8b0000" stroke="#333" stroke-width="2"/><text x="80" y="165" font-size="24" font-weight="bold" fill="green" text-anchor="middle">C</text><circle cx="250" cy="250" r="15" fill="#ff0000" stroke="#333" stroke-width="2"/><text x="250" y="300" font-size="24" font-weight="bold" fill="purple" text-anchor="middle">D</text></svg>',
                options: ["Stomach", "Liver", "Pancreas", "Gallbladder"],
                correct: 1,
                explanation: "The Liver (A) is the largest solid organ, located in the right upper quadrant. Divided by falciform ligament and functionally by Couinaud classification."
            },
            {
                region: "Abdomen - Axial",
                question: "Identify 'C' - the largest lymphoid organ:",
                svg: '<svg viewBox="0 0 500 400" class="anatomy-svg"><ellipse cx="250" cy="200" rx="200" ry="150" fill="#f5e6d3" stroke="#333" stroke-width="2"/><path d="M 250 100 L 380 150 L 370 250 L 260 230 Z" fill="#8b4513" stroke="#333" stroke-width="2"/><text x="310" y="180" font-size="24" font-weight="bold" fill="red" text-anchor="middle">A</text><ellipse cx="200" cy="180" rx="40" ry="50" fill="#ffb6c1" stroke="#333" stroke-width="2"/><text x="200" y="130" font-size="24" font-weight="bold" fill="blue" text-anchor="middle">B</text><ellipse cx="120" cy="160" rx="35" ry="45" fill="#8b0000" stroke="#333" stroke-width="2"/><text x="80" y="165" font-size="24" font-weight="bold" fill="green" text-anchor="middle">C</text><circle cx="250" cy="250" r="15" fill="#ff0000" stroke="#333" stroke-width="2"/><text x="250" y="300" font-size="24" font-weight="bold" fill="purple" text-anchor="middle">D</text></svg>',
                options: ["Left kidney", "Pancreas", "Spleen", "Adrenal"],
                correct: 2,
                explanation: "The Spleen (C) is in the left upper quadrant, posterolateral to stomach. Largest lymphoid organ (up to 12cm), functions in immune response and blood filtration."
            },
            {
                region: "Abdomen - Axial",
                question: "Identify 'D' - main arterial vessel:",
                svg: '<svg viewBox="0 0 500 400" class="anatomy-svg"><ellipse cx="250" cy="200" rx="200" ry="150" fill="#f5e6d3" stroke="#333" stroke-width="2"/><path d="M 250 100 L 380 150 L 370 250 L 260 230 Z" fill="#8b4513" stroke="#333" stroke-width="2"/><text x="310" y="180" font-size="24" font-weight="bold" fill="red" text-anchor="middle">A</text><ellipse cx="200" cy="180" rx="40" ry="50" fill="#ffb6c1" stroke="#333" stroke-width="2"/><text x="200" y="130" font-size="24" font-weight="bold" fill="blue" text-anchor="middle">B</text><ellipse cx="120" cy="160" rx="35" ry="45" fill="#8b0000" stroke="#333" stroke-width="2"/><text x="80" y="165" font-size="24" font-weight="bold" fill="green" text-anchor="middle">C</text><circle cx="250" cy="250" r="15" fill="#ff0000" stroke="#333" stroke-width="2"/><text x="250" y="300" font-size="24" font-weight="bold" fill="purple" text-anchor="middle">D</text></svg>',
                options: ["IVC", "SMA", "Aorta", "Portal Vein"],
                correct: 2,
                explanation: "The Aorta (D) is anterior and left of spine. Bifurcates at L4. Major branches: celiac trunk, SMA, renal arteries, IMA. Normal diameter <3cm."
            },
            {
                region: "Brain - CSF",
                question: "Which structure produces cerebrospinal fluid?",
                svg: '<svg viewBox="0 0 400 300" class="anatomy-svg"><ellipse cx="200" cy="150" rx="150" ry="120" fill="#e8d4c0" stroke="#333" stroke-width="2"/><ellipse cx="160" cy="150" rx="25" ry="40" fill="#87CEEB" stroke="#333" stroke-width="2"/><ellipse cx="240" cy="150" rx="25" ry="40" fill="#87CEEB" stroke="#333" stroke-width="2"/><path d="M 155 145 L 160 150 L 155 155" stroke="#ff0000" stroke-width="3" fill="none"/><path d="M 165 145 L 160 150 L 165 155" stroke="#ff0000" stroke-width="3" fill="none"/><text x="200" y="250" font-size="18" fill="#333" text-anchor="middle">Choroid Plexus in Ventricles</text></svg>',
                options: ["Arachnoid granulations", "Ependymal cells", "Choroid plexus", "Meninges"],
                correct: 2,
                explanation: "The Choroid Plexus produces ~500mL CSF daily in lateral, third, and fourth ventricles. CSF is reabsorbed by arachnoid granulations."
            },
            {
                region: "Brain - Vascular",
                question: "What provides collateral blood supply to the brain?",
                svg: '<svg viewBox="0 0 400 300" class="anatomy-svg"><ellipse cx="200" cy="200" rx="150" ry="80" fill="none" stroke="#ff0000" stroke-width="4"/><line x1="180" y1="120" x2="180" y2="160" stroke="#ff0000" stroke-width="3"/><line x1="220" y1="120" x2="220" y2="160" stroke="#ff0000" stroke-width="3"/><text x="200" y="110" font-size="16" fill="#333" text-anchor="middle">ACA</text><line x1="120" y1="180" x2="80" y2="160" stroke="#ff0000" stroke-width="3"/><line x1="280" y1="180" x2="320" y2="160" stroke="#ff0000" stroke-width="3"/><text x="60" y="155" font-size="16" fill="#333">MCA</text><text x="200" y="50" font-size="20" font-weight="bold" fill="#333" text-anchor="middle">Circle of Willis</text></svg>',
                options: ["Circle of Zinn", "Circle of Willis", "Vertebrobasilar Circle", "Arterial Hexagon"],
                correct: 1,
                explanation: "The Circle of Willis connects internal carotid and vertebrobasilar systems. Complete circles in ~50% of people. Components: ACA, AComm, ICA, PComm, PCA."
            },
            {
                region: "Knee - Meniscus",
                question: "Normal menisci appear as what signal on MRI?",
                svg: '<svg viewBox="0 0 400 200" class="anatomy-svg"><rect x="100" y="50" width="200" height="80" fill="#f0e6d2" stroke="#333" stroke-width="2"/><path d="M 140 130 Q 200 120 260 130" fill="#000000" stroke="#333" stroke-width="2"/><text x="200" y="170" font-size="18" fill="#333" text-anchor="middle">Normal Meniscus</text><text x="200" y="190" font-size="14" fill="#333" text-anchor="middle">(Uniformly Dark/Hypointense)</text></svg>',
                options: ["Bright on T1, dark on T2", "Dark on all sequences", "Bright on all sequences", "Variable"],
                correct: 1,
                explanation: "Normal menisci are uniformly DARK on all sequences due to fibrocartilage with low water. Internal signal suggests degeneration/tear (Grade 3 = tear)."
            },
            {
                region: "Spine - Landmarks",
                question: "Which vertebral level corresponds to the iliac crest?",
                svg: '<svg viewBox="0 0 300 400" class="anatomy-svg"><rect x="130" y="50" width="40" height="250" fill="#f0e6d2" stroke="#333" stroke-width="2"/><text x="90" y="80" font-size="16" fill="#333">L1</text><text x="90" y="130" font-size="16" fill="#333">L2</text><text x="90" y="180" font-size="16" fill="#333">L3</text><text x="90" y="230" font-size="16" fill="#333">L4</text><text x="90" y="280" font-size="16" fill="#333">L5</text><path d="M 80 230 Q 150 220 220 230" stroke="#ff0000" stroke-width="4" fill="none"/><text x="150" y="260" font-size="16" font-weight="bold" fill="red" text-anchor="middle">Iliac Crest</text></svg>',
                options: ["L2-L3", "L3-L4", "L4-L5", "L5-S1"],
                correct: 2,
                explanation: "Iliac crest = L4-L5 interspace. Important landmark for lumbar puncture (L3-L4 or L4-L5) to avoid conus medullaris injury (ends at L1-L2)."
            }
        ];

        let currentQuestion = 0;
        let userAnswers = [];

        function initTest() {
            renderQuestion();
            updateProgress();
        }

        function renderQuestion() {
            const container = document.getElementById('questionsContainer');
            const question = questions[currentQuestion];
            
            let optionsHTML = '';
            question.options.forEach((option, index) => {
                const isSelected = userAnswers[currentQuestion] === index;
                const isCorrect = index === question.correct;
                const showAnswer = userAnswers[currentQuestion] !== undefined;
                
                let optionClass = 'option';
                if (showAnswer) {
                    if (isSelected) optionClass += isCorrect ? ' correct' : ' incorrect';
                    else if (isCorrect) optionClass += ' correct';
                } else if (isSelected) {
                    optionClass += ' selected';
                }
                
                optionsHTML += `<label class="${optionClass}" onclick="selectAnswer(${index})">
                    <input type="radio" name="answer" value="${index}" ${isSelected ? 'checked' : ''} ${showAnswer ? 'disabled' : ''}>
                    ${option}
                </label>`;
            });
            
            const showExplanation = userAnswers[currentQuestion] !== undefined;
            
            container.innerHTML = `
                <div class="question-container active">
                    <div class="question-header">
                        <span class="question-number">Question ${currentQuestion + 1} of ${questions.length}</span>
                        <span class="region-tag">${question.region}</span>
                    </div>
                    
                    <div class="question-text">${question.question}</div>
                    
                    <div class="anatomy-image-container">${question.svg}</div>
                    
                    <div class="options">${optionsHTML}</div>
                    
                    <div class="explanation ${showExplanation ? 'show' : ''}">
                        <h4>üí° Explanation</h4>
                        <p>${question.explanation}</p>
                    </div>
                    
                    <div class="buttons">
                        <button class="btn btn-secondary" onclick="previousQuestion()" ${currentQuestion === 0 ? 'disabled' : ''}>
                            ‚Üê Previous
                        </button>
                        ${userAnswers[currentQuestion] === undefined ? 
                            `<button class="btn btn-primary" onclick="checkAnswer()" disabled id="checkBtn">Check Answer</button>` :
                            currentQuestion < questions.length - 1 ?
                            `<button class="btn btn-primary" onclick="nextQuestion()">Next ‚Üí</button>` :
                            `<button class="btn btn-primary" onclick="showResults()">View Results</button>`
                        }
                    </div>
                </div>
            `;
        }

        function selectAnswer(index) {
            const checkBtn = document.getElementById('checkBtn');
            if (checkBtn) checkBtn.disabled = false;
            document.querySelectorAll('.option').forEach((opt, i) => {
                opt.classList.toggle('selected', i === index);
            });
        }

        function checkAnswer() {
            const selected = document.querySelector('input[name="answer"]:checked');
            if (!selected) return;
            userAnswers[currentQuestion] = parseInt(selected.value);
            renderQuestion();
            updateProgress();
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                renderQuestion();
                updateProgress();
                window.scrollTo(0, 0);
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                renderQuestion();
                updateProgress();
                window.scrollTo(0, 0);
            }
        }

        function updateProgress() {
            document.getElementById('progressFill').style.width = ((currentQuestion + 1) / questions.length * 100) + '%';
        }

        function showResults() {
            let correct = 0;
            const regionScores = {};
            
            questions.forEach((question, index) => {
                const region = question.region;
                if (!regionScores[region]) regionScores[region] = { correct: 0, total: 0 };
                regionScores[region].total++;
                
                if (userAnswers[index] === question.correct) {
                    correct++;
                    regionScores[region].correct++;
                }
            });
            
            const percentage = Math.round((correct / questions.length) * 100);
            
            document.getElementById('questionsContainer').style.display = 'none';
            
            let message = percentage >= 90 ? 'Excellent anatomy knowledge! üéâ' :
                         percentage >= 80 ? 'Great work! Review missed areas. üìö' :
                         percentage >= 70 ? 'Good foundation. Keep practicing! üí™' :
                         'Keep studying! Anatomy takes practice. üìñ';
            
            let breakdownHTML = '';
            for (const region in regionScores) {
                const score = regionScores[region];
                const regionPercent = Math.round((score.correct / score.total) * 100);
                breakdownHTML += `<div class="category-card"><h4>${region}</h4><p>${score.correct}/${score.total} (${regionPercent}%)</p></div>`;
            }
            
            document.getElementById('scoreCircle').textContent = percentage + '%';
            document.getElementById('resultMessage').textContent = message;
            document.getElementById('categoryBreakdown').innerHTML = breakdownHTML;
            document.getElementById('results').classList.add('show');
        }

        function restartTest() {
            currentQuestion = 0;
            userAnswers = [];
            document.getElementById('results').classList.remove('show');
            document.getElementById('questionsContainer').style.display = 'block';
            renderQuestion();
            updateProgress();
            window.scrollTo(0, 0);
        }

        function reviewAnswers() {
            currentQuestion = 0;
            document.getElementById('results').classList.remove('show');
            document.getElementById('questionsContainer').style.display = 'block';
            renderQuestion();
            updateProgress();
            window.scrollTo(0, 0);
        }

        initTest();
    </script>
</body>
</html>